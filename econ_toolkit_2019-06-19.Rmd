---
title: "The Applied Economist's Data Science Toolkit"
subtitle: ""  
author: "Wei Yang Tham"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = 'center', warning = FALSE, message = FALSE)

```

```{r xaringan-themer, include=FALSE}
library(xaringanthemer)
solarized_dark(
  code_font_family = "Fira Code",
  code_font_url    = "https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css"
)
```

```{r}
rm(list = ls())
library(tidyverse)
library(magrittr)
theme_set(theme_minimal(base_size = 13))
```


---
class: center, middle

# About Me

PhD candidate in Economics at The Ohio State University

**Use tools from applied econometrics** to study science and innovation

---

# Goals

Provide intuition for "methods" that economists have been using

Inspiration for ways you might apply this in the context you work in

---

# Caveats

Lots of advances in methodology have come from other fields including political science, epidemiology, statistics, computer science

Only one part of econometrics and economics

---

class: centre, middle

# Data scientists wear many hats

```{r, out.width="45%", fig.align='default'}
knitr::include_graphics(c("img/beta_hat.png", "img/y_hat.jpg"))

```

---

## Prediction vs causation


## $$y = X_1\beta_1 + \epsilon$$
---

$\hat{y}$ - If a student with a certain set of characteristics $X_i$ (e.g. test scores, demographics) arrives, what is my best guess of their future wages?

$\hat{\beta}$ - If I implement an educational intervention, what is my best guess of how much their wages will increase?

--

Estimating $\hat{\beta}$ is the bread and butter of many applied economists 

---

Why can't we just run a regression of $y$ on $X$?

---

## People don't make choices randomly

E.g. people don't randomly choose whether to go to college 

---

## Threats to validity

Omitted variable bias - people make choices to 

Reverse causation - Umbrellas cause rain


---

## Randomized experiments are often treated as the gold standard

---

## But RCTs are not always feasible

- Feasibility or expense
- Ethics

---

Which is where quasi-experiments come in

---

## Quasi-experimental designs

- Instrumental variables
- Difference-in-differences
  + Synthetic control
- Matching
- Regression discontinuity


---

# Design vs methods

- Focus is on *credible* design
- Advantages: assumptions are transparent, focuses the discussion

---
class: middle, inverse

The applied economist's toolkit

---

## Instrumental variables

- Can address confounding and reverse causality

---

```{r}
knitr::include_graphics("img/iv_dag.png")
```

---

## What makes a good instrument?

- Relevant 
- Has an effect on the intervention

- Exclusion restriction
- Only related to the outcome through its effect on intervention

---

## Where to find instruments

- Gender of children as instrument for family size
- Quarter-of-birth for years spent in school
- Muslim holidays as instrument for number of drivers on the road
- **Randomization** is a great instrument - e.g. Oregon medicaid lottery

---

## A/B tests can be instruments too!
  

---

### If you run A/B tests you have instruments too!

Example

---

## Difference-in-differences accounts for underlying time trends

- When you observe a group over multiple periods of time
- Commonly used to compare policy changes across cities or states

---

```{r dd_plots}

set.seed(1)
n <- 10 ^ 3

simulatedError <- rnorm(n = n)
group <- sample(c(T, F), n, replace = TRUE)

df <- tibble(time = 10 * round(runif(n), 1) - 5,
                 treatment = group,
                 error = simulatedError)

df %<>%
    mutate(Y = 1 + time + 5 * treatment + 7 * (time >= 0) * treatment + error)

# fit <- lm(Y ~ time + treatment + I((time >= 0) * treatment), data = df)
# summary(fit)

dfmean <- df %>%
    group_by(time, treatment) %>%
    summarise(Y = mean(Y))

df %<>% 
  mutate(g = case_when(
    treatment & time < 0 ~ 1, 
    treatment & time >= 0 ~ 2, 
    !treatment & time < 0 ~ 3, 
    !treatment & time >= 0 ~ 4
  ))

ggplot(data = df, 
       aes(x = time, y = Y, 
           colour = treatment, 
           group = g
           )
       ) + 
  geom_point() + 
  geom_smooth(method = lm, se = FALSE) + 
  theme(legend.position = "none") + 
  scale_color_manual(values = c("#F05253", "#2A73CC", "#F05253", "#2A73CC"))
```

---

## Difference-in-differences relies on the parallel trend assumption

```{r}

dd_counterfac = df %>% 
  filter(treatment, time >= 0) %>% 
  mutate(Y = Y - 7)

ggplot(data = df, 
       aes(x = time, y = Y, 
           colour = treatment, 
           group = g
           )
       ) + 
  geom_smooth(data = dd_counterfac, 
              aes(x = time, y = Y), 
              colour = "grey", se = FALSE, method = "lm") + 
  geom_smooth(method = lm, se = FALSE) + 
  theme(legend.position = "none") + 
  scale_color_manual(values = c("#F05253", "#2A73CC", "#F05253", "#2A73CC"))

```


---

Classic example: Card and Krueger (1993)

- Compared employment in New Jersey and Pennsylvania before and after minimum wage was raised in New Jersey

---

## Effectiveness of Search Engine Marketing (SEM)

---

## Synthetic Control is a close cousin of difference-in-differences

Used in comparative case studies - how did an event affect aggregate outcomes of a single unit (e.g. country, state)?

Example: What was the economic impact of reunification on West Germany?

---

## Synthetic control finds the weighted combination of countries that are most similar to Germany

- Minimize the distance between West Germany and potential control countries based on a set of pre-unification variables 

---

## Regression discontinuity

---

## What can't quasi-experiments do

- Experiment you want vs experiment you get
- Local average treatment effects
- External validity

---

## Econometrics and Machine Learning

---

# Resources 

- Mostly Harmless Econometrics or Mastering 'Metrics
- [What's the Science in Data Science? - Skipper Seabold](https://youtu.be/kTo16ieMCi8)







